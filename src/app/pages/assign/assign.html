<form nz-form class="filter">
  <div nz-row [nzGutter]="12" nzJustify="space-between" nzAlign="middle">

    <div nz-col nzFlex="1">
      <div nz-row [nzGutter]="12">
        <div nz-col nzFlex="1">
          <input nz-input placeholder="Tìm ca thi, cán bộ, giám sát..." [(ngModel)]="searchInput"
            [ngModelOptions]="{standalone: true}">
        </div>
        <div nz-col>
          <button nz-button nzType="primary" type="button" (click)="onSearch()">Tìm kiếm</button>
        </div>
      </div>
    </div>

    <div nz-col>
      <button nz-button nzType="primary" type="button" (click)="showAddModal()">Thêm mới</button>
    </div>

  </div>
</form>

<nz-table [nzData]="filteredData" nzBordered>
  <thead>
    <tr>
      <th>Ca thi</th>
      <th>Số cán bộ</th>
      <th>Giám sát</th>
      <th>Hành động</th>
    </tr>
  </thead>

  <tbody>
    @for (r of filteredData; track r.id) {
    <tr>
      <td>{{r.slot}}</td>
      <td>{{r.proctors.join(', ')}}</td>
      <td>{{r.supervisor}}</td>
      <td>
        <nz-icon class="icon-action" nzType="edit" nzTheme="twotone" (click)="showEditModal(r)" />
        <nz-icon class="icon-action" nzType="delete" nzTheme="twotone" (click)="deleteAssignment(r.id)" />
        <nz-icon class="icon-action" nzType="eye" nzTheme="twotone" (click)="showDetail(r)" />
        <!-- <nz-icon class="icon-action" nzType="eye" nzTheme="twotone" /> -->
      </td>
    </tr>
    }
  </tbody>
</nz-table>


<!-- ==============================
       MODAL PHÂN CÔNG
================================-->
<nz-modal [(nzVisible)]="isVisible" [nzTitle]="isEditing ? 'Cập nhật phân công' : 'Thêm phân công mới'"
  (nzOnCancel)="handleCancel()" (nzOnOk)="handleOk()">

  <ng-container *nzModalContent>
    <form nz-form>

      <!-- Ca thi -->
      <nz-form-item>
        <nz-form-label [nzSpan]="6">Ca thi</nz-form-label>
        <nz-form-control [nzSpan]="16">

          <nz-select nzPlaceHolder="Chọn ca thi" [(ngModel)]="assignmentForm.slot"
            (ngModelChange)="onSlotChange($event)" [ngModelOptions]="{standalone: true}" style="width: 100%">

            <nz-option *ngFor="let s of scheduleList" [nzValue]="s.id"
              [nzLabel]="s.courseCode + ' | ' + s.date + ' | ' + s.startTime + ' | ' + s.roomName">
            </nz-option>

          </nz-select>

        </nz-form-control>
      </nz-form-item>

      <!-- Cán bộ -->
      <nz-form-item>
        <nz-form-label [nzSpan]="6">Cán bộ</nz-form-label>
        <nz-form-control [nzSpan]="16">
          <input nz-input [(ngModel)]="assignmentForm.proctors" [ngModelOptions]="{standalone: true}">
        </nz-form-control>
      </nz-form-item>

      <!-- Giám sát -->
      <nz-form-item>
        <nz-form-label [nzSpan]="6">Giám sát</nz-form-label>
        <nz-form-control [nzSpan]="16">
          <input nz-input [(ngModel)]="assignmentForm.supervisor" [ngModelOptions]="{standalone: true}">
        </nz-form-control>
      </nz-form-item>

    </form>
  </ng-container>

</nz-modal>


<nz-modal [(nzVisible)]="isDetailVisible" nzTitle="Chi tiết phân công" (nzOnCancel)="isDetailVisible = false"
  [nzFooter]="null">

  <ng-container *nzModalContent>

    <nz-table nzBordered [nzData]="[detailData]">
      <thead>
        <tr>
          <th>Mã HP</th>
          <th>Ngày</th>
          <th>Giờ</th>
          <th>Phòng</th>
          <th>Cán bộ</th>
          <th>Giám sát</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngIf="detailData">
          <td>{{ detailData.slot.split(' | ')[0] }}</td>
          <td>{{ detailData.slot.split(' | ')[1] }}</td>
          <td>{{ detailData.slot.split(' | ')[2] }}</td>
          <td>{{ detailData.slot.split(' | ')[3] }}</td>
          <td>{{ detailData.proctors.join(', ') }}</td>
          <td>{{ detailData.supervisor }}</td>
        </tr>
      </tbody>
    </nz-table>

  </ng-container>

</nz-modal>